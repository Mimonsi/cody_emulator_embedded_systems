1     REM Field 18x18
2     REM VARIABLES: A,B,C FIELD; R RETURN VALUE; I,J ITERATION; M,N,Q,W TEMP; X,Y FIELD COORDS; O,P; SELECTOR COORDS
3     REM Field: 63 MINE, 0-62 Surrounded by, 7th bit flagged, 8th bit revealed
10    REM LOAD CUSTOM CHARACTERS
11    FOR I=0 TO 63
12      READ M
13      POKE 51200+144*8+I,M
14    NEXT
15    REM
20    O=8
21    P=8
90    PRINT CHR$(222)
99    PRINT "GENERATING..."
100   REM GENERATE FIELD
101   FOR Y=0 TO 17
102     FOR X=0 TO 17
103       F=AND(RND(),7)
110       IF F <> 0 THEN GOTO 290
119       REM its a mine (mario)
120       Z=63
121       D=D+1
123       GOSUB 20100
130       Q=X
131       W=Y
140       FOR I=-1 TO 1
141         FOR J=-1 TO 1
142           IF OR(I, J) = 0 THEN GOTO 146
143           X=Q+I
144           Y=W+J
145           GOSUB 20200
146           F=777            
147         NEXT
148       NEXT
160       X=Q
161       Y=W
290       REM its not a mine
299     NEXT
300   NEXT
400   PRINT "GENERATION DONE"
3000  REM GAME LOOP
3001  IF E=324-D THEN GOTO 10100
3009  M=(P+4)*40
3010  POKE 50176+O*2+2+M,144
3011  POKE 50176+O*2+3+M,145
3018  Q=O
3019  W=P
3020  IF AND(1, PEEK(16+5)) = 0 THEN P=P-1
3021  IF AND(1, PEEK(16+4)) = 0 THEN P=P+1
3022  IF AND(1, PEEK(16+1)) = 0 THEN O=O-1
3023  IF AND(2, PEEK(16+1)) = 0 THEN O=O+1
3024  IF AND(16, PEEK(16+4)) = 0 THEN GOTO 3300
3025  IF AND(16, PEEK(16+3)) = 0 THEN GOTO 3400
3026  IF O < 0 THEN O = Q
3027  IF O > 17 THEN O = Q
3028  IF P < 0 THEN P = W
3029  IF P > 17 THEN P = W
3030  IF Q <> O THEN GOTO 3050
3031  IF W <> P THEN GOTO 3050
3049  GOTO 3000
3050  REM CHANGE DETECTED
3051  X=Q
3052  Y=W
3053  GOSUB 20000
3060  M=(W+4)*40
3061  N=163
3062  IF AND(R,64) <> 0 THEN N=147
3063  IF AND(R,128) <> 0 THEN N=48+AND(R,63)
3070  POKE 50176+Q*2+3+M,N
3071  POKE 50176+Q*2+2+M,163
3072  IF N=147 THEN POKE 50176+Q*2+2+M,146
3290  GOTO 3000
3300  REM TOGGLE FLAG
3301  X=Q
3302  Y=W
3303  GOSUB 20000
3304  Z=XOR(R, 64)
3305  GOSUB 20100
3350  GOTO 3000
3400  REM REVEAL
3401  X=Q
3402  Y=W
3403  GOSUB 20000
3410  IF R = 63 THEN GOTO 10000
3494  Z=OR(R, 128)
3495  GOSUB 20100
3496  E=E+1
3500  GOTO 3000
10000 REM END GAME
10001 PRINT CHR$(222)
10002 PRINT "YOU LOOSE :("
10003 END
10100 REM WIN GAME
10101 PRINT CHR$(222)
10102 PRINT "YOU WON! :)"
10103 END
20000 REM GET FIELD
20010 N=X+Y*18
20011 M=MOD(N,128)
20020 IF N < 128 THEN GOTO 20024
20021 IF N < 256 THEN GOTO 20026
20022 IF N < 384 THEN GOTO 20028
20023 RETURN
20024 R=A(M)
20025 RETURN
20026 R=B(M)
20027 RETURN
20028 R=C(M)
20029 RETURN
20100 REM SET FIELD
20110 N=X+Y*18
20111 M=MOD(N,128)
20120 IF N < 128 THEN GOTO 20124
20121 IF N < 256 THEN GOTO 20126
20122 IF N < 384 THEN GOTO 20128
20123 RETURN
20124 A(M)=Z
20125 RETURN
20126 B(M)=Z
20127 RETURN
20128 C(M)=Z
20129 RETURN
20200 REM NOTIFY NEIGHBOR
20201 IF X < 0 THEN RETURN
20202 IF X > 17 THEN RETURN
20203 IF Y < 0 THEN RETURN
20204 IF Y > 17 THEN RETURN
20205 GOSUB 20000
20206 IF R = 63 THEN RETURN
20207 Z=R+1
20208 GOSUB 20100
20209 RETURN
29999 REM GRAPHICS
30000 REM pickaxe-0, 144
30001 DATA 5, 20, 84, 65, 64, 0, 0, 0 
30002 REM pickaxe-1, 145
30003 DATA 64, 0, 0, 0, 64, 16, 4, 1
30004 REM flag-0, 146
30005 DATA 1, 5, 21, 5, 1, 0, 0, 21
30006 REM flag-1, 147
30007 DATA 64, 64, 64, 64, 64, 64, 64, 84
30008 REM none-0, 148
30009 DATA 0, 0, 1, 5, 21, 21, 85, 85
30010 REM none-1, 149
30011 DATA 0, 0, 0, 80, 85, 85, 85, 85
30012 REM goblin-0, 150
30013 DATA 1, 5, 1, 5, 17, 1, 4, 16
30014 REM goblin-1, 151
30015 DATA 0, 64, 0, 64, 16, 0, 64, 16


