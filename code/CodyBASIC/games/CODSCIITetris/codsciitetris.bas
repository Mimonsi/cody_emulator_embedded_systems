5 N=0
10 READ A
20 IF A<0 THEN GOTO 55
30 I(N) = A
40 N=N+1
50 GOTO 10
55 N=0
60 READ A
70 IF A<0 THEN GOTO 105
80 O(N) = A
90 N=N+1
100 GOTO 60
105 N=0
110 READ A
120 IF A<0 THEN GOTO 155
130 T(N) = A
140 N=N+1
150 GOTO 110
155 N=0
160 READ A
170 IF A<0 THEN GOTO 205
180 S(N) = A
190 N=N+1
200 GOTO 160
205 N=0
210 READ A
220 IF A<0 THEN GOTO 255
230 Z(N) = A
240 N=N+1
250 GOTO 210
255 N=0
260 READ A
270 IF A<0 THEN GOTO 305
280 J(N) = A
290 N=N+1
300 GOTO 260
305 N=0
310 READ A
320 IF A<0 THEN GOTO 355
330 L(N) = A
340 N=N+1
350 GOTO 310
355 T=3
356 R=0
357 X=3
358 Y=0
359 Q(1)=0
360 FOR I=0 TO 100
370 W(I)=0
375 V(I)=0
380 NEXT
400 POKE 53250,OR(AND(PEEK(53250),240),0)
410 PRINT CHR$(222)
420 PRINT AT(0,0), "CODSCII Tetris"
430 PRINT AT(30,0), "Score:"
440 FOR I=2 TO 21
450 PRINT AT(7,I),"<! . . . . . . . . . .!>"
460 NEXT
470 PRINT AT(7,22), "<!====================!>"
480 PRINT AT(7,23), "  \/\/\/\/\/\/\/\/\/\/  "
490 FOR I=0 TO 999
500 POKE 55296+I,5*16
510 NEXT
514 GOSUB 41000
515 GOSUB 40000
2000 Q=PEEK(17)
2001 Q(20)=PEEK(22)
2010 IF Q=30 THEN GOSUB 42600 
2011 IF Q(20)=27 THEN GOSUB 42600
2020 IF Q=29 THEN GOSUB 42700 
2021 IF Q(20)=23 THEN GOSUB 42700
2030 IF Q=23 THEN GOSUB 41100 
2031 IF Q(20)=15 THEN GOSUB 41100
2040 Q=PEEK(20)
2050 IF Q=23 THEN GOSUB 41200
2051 IF Q=15 THEN GOTO 355
2053 Q=PEEK(21)
2054 IF Q(20)=30 THEN GOSUB 42800
2056 IF Q=30 THEN GOSUB 42800
2060 GOSUB 41600
2498 GOTO 514
40000 REM DRAW TETROMINO
40010 FOR A=0 TO 3
40020 FOR B=0 TO 3
40030 C = R*16 + A*4 + B
40040 GOSUB 40100
40050 NEXT
40060 NEXT
40070 RETURN
40100 REM CORRECT PIECE
40110 IF T=1 THEN D = I(C)
40120 IF T=2 THEN D = O(C)
40130 IF T=3 THEN D = T(C)
40140 IF T=4 THEN D = S(C)
40150 IF T=5 THEN D = Z(C)
40160 IF T=6 THEN D = J(C)
40170 IF T=7 THEN D = L(C)
40180 IF D=1 THEN GOSUB 40200
40190 RETURN
40200 REM DRAW BLOCK
40210 E = 50265 + (Y+A)*40 + (X+B)*2
40220 POKE E, 91   
40230 POKE E+1, 93 
40240 RETURN
40300 REM LEFT OFFSET
40310 A = 4
40320 FOR B = 0 TO 3
40330 FOR C = 0 TO 3
40340 D = R*16 + C*4 + B
40350 GOSUB 40400
40360 IF E=1 THEN GOTO 40365
40361 GOTO 40370
40365 IF B<A THEN A=B
40370 NEXT
40380 NEXT
40390 RETURN
40400 REM T TO TETRONOMINO
40410 IF T=1 THEN E = I(D)
40420 IF T=2 THEN E = O(D)
40430 IF T=3 THEN E = T(D)
40440 IF T=4 THEN E = S(D)
40450 IF T=5 THEN E = Z(D)
40460 IF T=6 THEN E = J(D)
40470 IF T=7 THEN E = L(D)
40480 RETURN
40500 REM WIDTH
40510 B = 0
40520 FOR C = 0 TO 3
40530 FOR F = 0 TO 3
40540 D = R*16 + F*4 + C
40550 GOSUB 40400
40560 IF E=1 THEN B = C+1
40570 NEXT
40580 NEXT
40590 B=B-A
40600 RETURN
40700 REM ERASE TETROMINO
40710 FOR A=0 TO 3
40720 FOR B=0 TO 3
40730 C = R*16 + A*4 + B
40740 GOSUB 40800
40750 NEXT
40760 NEXT
40770 RETURN
40800 REM CORRECT PIECE
40810 IF T=1 THEN D = I(C)
40820 IF T=2 THEN D = O(C)
40830 IF T=3 THEN D = T(C)
40840 IF T=4 THEN D = S(C)
40850 IF T=5 THEN D = Z(C)
40860 IF T=6 THEN D = J(C)
40870 IF T=7 THEN D = L(C)
40880 IF D=1 THEN GOSUB 40900
40890 RETURN
40900 REM KILL BLOCK
40910 E = 50265 + (Y+A)*40 + (X+B)*2
40920 POKE E, 32   
40930 POKE E+1, 46
40940 RETURN
41000 REM TOP OFFSET
41010 G = 4
41020 FOR H = 0 TO 3
41030 FOR K = 0 TO 3
41040 D = R*16 + H*4 + K
41050 GOSUB 40400
41060 IF E=1 THEN GOTO 41065
41061 GOTO 41070
41065 IF H<G THEN G=H
41070 NEXT
41080 NEXT
41090 RETURN
41100 REM ROTATE CW
41105 GOSUB 40700
41110 Q(4) = R
41120 R = R + 1
41130 IF R > 3 THEN R = 0
41140 GOSUB 40300   
41150 GOSUB 40500   
41160 GOSUB 41000   
41170 IF X + A < 0 THEN R = Q(4)
41180 IF X + A + B > 10 THEN R = Q(4)
41190 RETURN
41200 REM ROTATE CCW
41205 GOSUB 40700
41210 Q(4) = R
41220 R = R - 1
41230 IF R < 0 THEN R = 3
41240 GOSUB 40300   
41250 GOSUB 40500   
41260 GOSUB 41000   
41270 IF X + A < 0 THEN R = Q(4)
41280 IF X + A + B > 10 THEN R = Q(4)
41290 RETURN
41300 REM GRAVITY 
41330 GOSUB 41000   
41340 GOSUB 41400
41345 GOSUB 41900
41350 IF N=0 THEN GOTO 41360
41355 GOTO 41370
41360 IF Y+H<20 THEN Y=Y+1
41361 GOTO 41395
41370 IF N=1 THEN GOTO 41380
41374 IF Y+H>= 20 THEN GOTO 41380
41375 GOTO 41395
41380 GOSUB 41700
41390 GOSUB 42100
41391 GOSUB 43000
41392 GOSUB 43800
41395 RETURN
41400 REM HEIGHT
41410 H = 0
41420 FOR A = 0 TO 3
41430 FOR B = 0 TO 3
41440 D = R*16 + A*4 + B
41450 GOSUB 40400
41460 IF E=1 THEN H = A+1
41470 NEXT
41480 NEXT
41490 H = H - G
41500 RETURN
41600 REM GRAVITY TIMER
41610 F = F + 1
41620 IF F < 20 THEN RETURN
41630 F = 0
41635 GOSUB 40700
41640 GOSUB 41300
41650 RETURN
41700 REM LOCK TETROMINO
41710 FOR A=0 TO 3
41720 FOR B=0 TO 3
41730 D = R*16 + A*4 + B
41740 GOSUB 40400
41750 IF E=1 THEN GOTO 41760
41755 GOTO 41800
41760 F = Y + A
41770 M = X + B
41771 IF F<10 THEN GOTO 41780
41772 P = (F-10)*10+M 
41773 V(P)=1
41774 GOTO 41800
41780 P = F*10 + M
41790 W(P)=1
41800 NEXT
41810 NEXT
41820 RETURN
41900 REM COLLISION DOWN
41910 N=0
41920 FOR A=0 TO 3
41930 FOR B=0 TO 3
41940 D = R*16 + A*4 + B
41950 GOSUB 40400
41960 IF E=1 THEN GOTO 41970
41965 GOTO 42020
41970 F = Y + A + 1
41980 M = X + B
41990 IF F>=20 THEN N=1
41991 IF F<10 THEN GOTO 42000
41992 P=(F-10)*10+M 
41993 IF V(P)=1 THEN N=1
41994 GOTO 42020
42000 P = F*10 + M
42010 IF W(P)=1 THEN N=1
42020 NEXT
42030 NEXT
42040 RETURN
42100 REM NEW TETRONIMONO
42103 GOSUB 44000   
42105 GOSUB 40000
42110 T=1+MOD(RND(),7)
42120 R=1
42130 X=3
42140 Y=0
42150 GOSUB 40300              
42160 GOSUB 40500              
42170 GOSUB 41000              
42180 GOSUB 41400        
42190 RETURN
42200 REM COLLISION LEFT
42210 N=0
42220 FOR A=0 TO 3
42230 FOR B=0 TO 3
42240 D = R*16 + A*4 + B
42250 GOSUB 40400
42260 IF E=1 THEN GOTO 42270
42265 GOTO 42300
42270 F = Y + A
42280 M = X + B - 1
42290 IF M<0 THEN N=1
42291 GOTO 42300
42292 IF F<10 THEN GOTO 42296
42293 P=(F-10)*10+M
42294 IF V(P)=1 THEN N=1
42295 GOTO 42300
42296 P=F*10+M
42297 IF W(P)=1 THEN N=1
42300 NEXT
42310 NEXT
42320 RETURN
42400 REM COLLISION RIGHT
42410 N=0
42420 FOR A=0 TO 3
42430 FOR B=0 TO 3
42440 D = R*16 + A*4 + B
42450 GOSUB 40400
42460 IF E=1 THEN GOTO 42470
42465 GOTO 42500
42470 F = Y + A
42480 M = X + B + 1
42490 IF M>=10 THEN N=1
42491 IF F<10 THEN GOTO 42495
42492 P=(F-10)*10+M
42493 IF V(P)=1 THEN N=1
42494 GOTO 42500
42495 P=F*10+M
42496 IF W(P)=1 THEN N=1
42500 NEXT
42510 NEXT
42520 RETURN
42600 REM MOVE LEFT
42610 GOSUB 42200
42620 IF N=1 THEN GOTO 42680
42621 GOSUB 40700
42630 X = X - 1
42640 GOSUB 40300
42650 GOSUB 40500
42660 GOSUB 41000
42670 IF X + A < 0 THEN X = X + 1
42675 GOSUB 41400
42680 RETURN
42700 REM MOVE RIGHT
42710 GOSUB 42400
42720 IF N=1 THEN GOTO 42780
42721 GOSUB 40700
42730 X = X + 1
42740 GOSUB 40300
42750 GOSUB 40500
42760 GOSUB 41000
42770 IF X + A + B > 10 THEN X = X - 1
42775 GOSUB 41400
42780 RETURN
42800 REM HARD DROP
42810 GOSUB 40700       
42820 GOSUB 41900        
42830 IF N=1 THEN GOTO 42880
42840 Y = Y + 1
42850 GOSUB 40300
42860 GOSUB 40500
42865 GOSUB 41000
42866 GOTO 42820   
42880 RETURN
43000 REM CHECK AND CLEAR LINES
43010 Q(2)=0
43020 FOR U=0 TO 19
43030 D=1
43040 FOR K=0 TO 9
43060 IF U<10 THEN GOTO 43070
43061 IF V((U-10)*10+K)=0 THEN D=0
43062 GOTO 43080
43070 IF W(U*10+K)=0 THEN D=0
43080 NEXT
43085 IF D=0 THEN GOTO 43100
43086 A=U
43087 GOSUB 43102
43088 GOSUB 43300
43089 Q(2)=Q(2)+1
43100 NEXT
43101 RETURN
43102 REM CLEAR LINE
43110 FOR F=0 TO 9
43120 IF A<10 THEN GOTO 43130
43121 P=(A-10)*10+F
43122 V(P)=0
43123 E=50265 + A*40 + F*2
43124 POKE E,32
43125 POKE E+1,46
43126 GOTO 43140
43130 P=A*10+F
43131 W(P)=0
43132 E=50265 + A*40 + F*2
43133 POKE E,32
43134 POKE E+1,46
43140 NEXT
43150 RETURN
43300 REM SHIFT STACK DOWN
43310 F=A
43320 REM loop until F=0
43330 IF F=0 THEN GOTO 43670
43340 FOR C=0 TO 9
43350 IF F<10 THEN GOTO 43454
43360 IF F=10 THEN GOTO 43520
43370 REM F>=11: copy within V from row F-1 to F
43380 P=(F-10)*10+C
43390 Q=(F-11)*10+C
43400 V(P)=V(Q)
43410 E=50265+F*40+C*2
43420 IF V(P)=1 THEN GOTO 43430
43425 POKE E,32
43426 POKE E+1,46
43427 GOTO 43450
43430 POKE E,91
43435 POKE E+1,93
43450 NEXT
43451 GOTO 43600
43454 REM F<=9: copy within W from row F-1 to F
43455 P=F*10+C
43460 Q=(F-1)*10+C
43470 W(P)=W(Q)
43480 E=50265+F*40+C*2
43490 IF W(P)=1 THEN GOTO 43500
43495 POKE E,32
43496 POKE E+1,46
43497 GOTO 43510
43500 POKE E,91
43505 POKE E+1,93
43510 NEXT
43515 GOTO 43600
43520 REM boundary: copy row 9 (W) into row 10 (V)
43530 P=(F-10)*10+C
43540 Q=9*10+C
43550 V(P)=W(Q)
43560 E=50265+F*40+C*2
43570 IF V(P)=1 THEN GOTO 43580
43575 POKE E,32
43576 POKE E+1,46
43577 GOTO 43590
43580 POKE E,91
43585 POKE E+1,93
43590 NEXT
43600 REM decrement F and loop again
43610 F=F-1
43620 GOTO 43330
43670 REM clear row 0 after cascade
43680 FOR C=0 TO 9
43690 W(C)=0
43700 E=50265+C*2
43710 POKE E,32
43720 POKE E+1,46
43730 NEXT
43740 RETURN
43800 REM UPDATE SCORE 
43910 IF Q(2)=1 THEN Q(1)=Q(1)+40
43920 IF Q(2)=2 THEN Q(1)=Q(1)+100
43930 IF Q(2)=3 THEN Q(1)=Q(1)+300
43940 IF Q(2)=4 THEN Q(1)=Q(1)+1200
43950 PRINT AT(36,0),CHR$(224),CHR$(245), Q(1) 
43960 RETURN 
44000 REM GAME OVER CHECK
44010 FOR A=0 TO 3
44020 FOR B=0 TO 3
44030 D=R*16+A*4+B
44040 GOSUB 40400
44050 IF E=1 THEN GOTO 44070
44060 GOTO 44100
44070 F=Y+A
44080 M=X+B
44090 IF F=0 THEN GOTO 44160
44100 NEXT
44155 NEXT
44156 RETURN
44160 REM GAME OVER SCREEN
44170 PRINT CHR$(222)
44180 PRINT AT(10,10),"GAME OVER"
44200 PRINT AT(10,11),"FINAL SCORE:",Q(1)
44210 PRINT AT(10,12),"TYPE RUN TO PLAY AGAIN"
44215 END
50000 DATA 0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0
50001 DATA 0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0
50002 DATA 0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0
50003 DATA 0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0
50004 DATA -1
50005 DATA 0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0
50006 DATA 0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0
50007 DATA 0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0
50008 DATA 0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0
50009 DATA -1
50010 DATA 0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0
50011 DATA 0,1,0,0,0,1,1,0,0,1,0,0,0,0,0,0
50012 DATA 0,0,0,0,1,1,1,0,0,1,0,0,0,0,0,0
50013 DATA 0,1,0,0,1,1,0,0,0,1,0,0,0,0,0,0
50014 DATA -1
50015 DATA 0,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0
50016 DATA 0,1,0,0,0,1,1,0,0,0,1,0,0,0,0,0
50017 DATA 0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0
50018 DATA 1,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0
50019 DATA -1
50020 DATA 1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0
50021 DATA 0,0,1,0,0,1,1,0,0,1,0,0,0,0,0,0
50022 DATA 0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0
50023 DATA 0,1,0,0,1,1,0,0,1,0,0,0,0,0,0,0
50024 DATA -1
50025 DATA 1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0
50026 DATA 0,1,1,0,0,1,0,0,0,1,0,0,0,0,0,0
50027 DATA 0,0,0,0,1,1,1,0,0,0,1,0,0,0,0,0
50028 DATA 0,1,0,0,0,1,0,0,1,1,0,0,0,0,0,0
50029 DATA -1
50030 DATA 0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0
50031 DATA 0,1,0,0,0,1,0,0,0,1,1,0,0,0,0,0
50032 DATA 0,0,0,0,1,1,1,0,1,0,0,0,0,0,0,0
50033 DATA 1,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0
50034 DATA -1

